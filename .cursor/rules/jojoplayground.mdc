# JoJoPlayground — Cursor Rules

You are working on **JoJoPlayground**, a SwiftUI iOS app for prototyping user flows using a custom design system. Follow these rules for all code generation and editing.

## Audience

Designers who use Cursor + Xcode to turn their Figma designs into working iOS prototypes. They have minimal coding, terminal, or git knowledge. Their workflow: design in Figma, describe what to build in Cursor, preview in Xcode.

## Design Enforcement Rules

1. **Strict visual parity**
   Use colors, typography, spacing, icons, images, and all visual details exactly as defined in Figma. Do not infer, approximate, or substitute.

2. **No assumptions**
   If any requirement is unclear, ambiguous, or missing, stop and ask for clarification before proceeding.

3. **Design system enforcement — always verify, never assume**
   If any color, font, or spacing value from a Figma design does not **exactly match** a defined token in `DSColors`, `DSTypography`, or `DSSpacing`, **stop and ask the user to verify or clarify** before proceeding. Specifically:
   - **Colors:** If a hex value doesn't match any `DSColors` token, flag it. Do not pick the "closest" token.
   - **Fonts:** If a font name, weight, or size doesn't match any `DSTypography` token, flag it. Do not approximate with a similar style.
   - **Spacing:** If a padding or gap value doesn't match any `DSSpacing` token, flag it. Do not round to the nearest token.
   - **Icons/Images:** If an asset is referenced but not found in `Assets.xcassets` or the design system, flag it.
   Always list the exact mismatched value and ask whether it should map to an existing token or be added as a new one.

4. **Navigation clarity required**
   If any screen navigation, routing, or transition logic is unclear, ask before implementing.

5. **Component logic clarity required**
   If any component state, interaction, or behavior is unclear, ask before implementing.

6. **Feature logic clarity required**
   If any feature-level logic or data flow is unclear, ask before implementing.

7. **Asset completeness**
   If any required icon, image, or asset is missing or undefined, ask before proceeding.

## Figma Input Rules

1. **Always use Figma MCP — never ask for screenshots**
   The Figma MCP provides structured design data (colors, fonts, spacing, layout) with exact values. Always use it as the primary way to read Figma designs. Never proactively suggest or request screenshots — screenshots are lossy and cannot guarantee accurate token values.

2. **Prefer Figma URLs over selection**
   When the user wants to build from a Figma design, ask them to provide **Figma URLs** (right-click frame > "Copy link to selection"). URLs are preferred because they are reliable, batchable, and create a record of what was referenced.
   - For **multi-state components**: Ask for a URL for each state/variant (e.g., Default, Active, Disabled, Error). Read all URLs via `get_design_context` in parallel before writing code.
   - For **multi-screen flows**: Ask for a URL for each screen frame. Read all in parallel to understand the full flow before building.
   - **Selection is fine for quick single-frame checks** during iteration (e.g., "I updated the frame, re-read it"). But for initial builds, always prefer URLs.
   Extract the node ID from each URL and call `get_design_context` for each one.

3. **If the MCP call fails — troubleshoot, then fall back**
   When a Figma MCP call fails or returns an error, walk the user through these steps in order:
   1. **Toggle the MCP:** Go to Cursor Settings > MCP, find the Figma entry, turn it off, wait a few seconds, turn it back on. (This fixes the most common issue.)
   2. **Check Figma desktop app:** Make sure the Figma desktop app is open — the browser version does not work with MCP.
   3. **Restart Cursor:** If the toggle didn't help, quit and reopen Cursor.
   4. **Screenshot fallback (last resort only):** If MCP still doesn't work after the above steps, accept a screenshot but warn the user that exact token values cannot be verified. Flag every color, font, and spacing value as "unverified — needs manual confirmation against the design system tokens."

## Xcode Behavior

- **Xcode 16+ automatically syncs new files.** New `.swift` files created inside the `JoJoPlayground/` source folder are automatically detected and included in the build target. No manual "Add to target" step is needed.

## Terminology

6 user-facing terms. Use Figma-friendly language. Code equivalents shown for Cursor's internal mapping.

- **Flow** — A multi-screen user journey (code: folder under `Features/` with `NavigationStack`). Example: "The checkout flow has 4 screens."
- **Screen / Frame** — A full-screen UI. Interchangeable: "screen" for the app, "frame" in Figma. Same thing. (code: a SwiftUI `View` struct, maps to a Step enum case)
- **Component** — A reusable UI piece (code: struct in `DesignSystem/Components/`). Components follow DS naming. Example: "Use the DSButton component."
- **Overlay** — Something on top of a screen: modal, sheet, dialog (code: `.sheet()`, `.fullScreenCover()`, `.overlay()`). Example: "Tapping Help shows a help overlay."
- **Token** — A named design value: color, font, or spacing (code: `DSColors`, `DSTypography`, `DSSpacing`). Example: "Use the primaryBackground token."
- **Asset** — An icon, image, or illustration (code: file in `Assets.xcassets/`). Example: "The confirmation screen uses the success-check asset."

Hierarchy: **Flow** > **Screen** (+ **Overlays**), built with **Components**, styled with **Tokens**, using **Assets**.

Internal code terms (NOT user-facing, handle automatically):
- "Step" — enum case mapping screens to navigation states
- "View" — SwiftUI protocol; screens, overlays, and components are all Views
- "Route" / "Destination" / "NavigationStack" — iOS navigation concepts

## Architecture

- **Pattern:** MVVM + Flow Coordinators
- **Navigation:** `NavigationStack` with enum-based type-safe routing (iOS 16+)
- **State:** `@Observable` classes (iOS 17+), injected via `.environment(viewModel)`
- **Root routing:** `ContentView` uses `@State private var activeFlow: AppFlow?` to switch between flows — no nested NavigationStacks

## Project Structure

```
Features/{FlowName}/
├── {FlowName}Flow.swift          # Flow coordinator (owns NavigationStack)
├── {FlowName}ViewModel.swift     # @Observable ViewModel + {FlowName}Step enum
└── Views/
    ├── FirstScreenView.swift
    └── ...
```

```
DesignSystem/
├── Tokens/                       # DSColors, DSTypography, DSSpacing, DSIcons
└── Components/                   # DS-prefixed reusable components
```

## Design System Token Reference

### Colors (DSColors)

**Primitives:** `primitiveBlack`, `primitiveWhite`, `primitiveBlue600`, `primitiveRed600`, `primitiveYellow300`, `primitiveGreen600`

**Background:** `backgroundPrimary` (#FFFFFF), `backgroundSecondary` (#F3F3F3), `backgroundTertiary` (#E8E8E8)

**Content:** `contentPrimary` (#000000), `contentSecondary` (#4B4B4B), `contentTertiary` (#5E5E5E)

**Border:** `borderOpaque` (#E8E8E8), `borderSelected` (#000000)

**Inverse:** `backgroundInversePrimary`, `backgroundInverseSecondary`, `contentInversePrimary`, `contentInverseSecondary`, `contentInverseTertiary`, `borderInverseOpaque`, `borderInverseSelected`

**Background Extensions:** `backgroundStateDisabled`, `backgroundAccent`, `backgroundNegative`, `backgroundWarning`, `backgroundPositive`, `backgroundAccentLight`, `backgroundNegativeLight`, `backgroundWarningLight`, `backgroundPositiveLight`, `backgroundAlwaysDark`, `backgroundAlwaysLight`

**Content Extensions:** `contentStateDisabled`, `contentOnColor`, `contentOnColorInverse`, `contentAccent`, `contentNegative`, `contentWarning`, `contentPositive`

**Border Extensions:** `borderStateDisabled`, `borderAccent`, `borderNegative`, `borderWarning`, `borderPositive`, `borderAccentLight`

**Programs:** `programsSafety`, `programsEats`, `programsFreight`, `programsRewardsTier2`, `programsRewardsTier3`, `programsRewardsTier4`, `programsMembership`

### Typography (DSTypography)

Font family: Lexend Deca (variable weight). Each style has a `Font` and a `lineHeight: CGFloat`.

| Token | Weight | Size | Line Height |
|-------|--------|------|-------------|
| `title` | Medium | 36px | 44px |
| `bodyEmphasized` | Medium | 18px | 28px |
| `bodyRegular` | Regular | 18px | 28px |
| `accentEmphasized` | Medium | 14px | 16px |
| `accentRegular` | Regular | 14px | 16px |
| `accentLight` | Light | 14px | 16px |
| `accentSmall` | Regular | 12px | 16px |

Usage: `.font(DSTypography.title)` and `.lineSpacing(DSTypography.titleLineHeight - 36)` or use `lineHeight` for frame calculations.

### Spacing (DSSpacing)

`none`=0, `s2`=2, `s4`=4, `s8`=8, `s12`=12, `s16`=16, `s20`=20, `s24`=24, `s28`=28, `s32`=32, `s36`=36, `s40`=40, `s48`=48, `s56`=56, `s64`=64, `s96`=96, `s128`=128

### Icons (DSIcons)

All icons are custom PDF vectors with Template Image rendering (tintable). Sizes from Figma spec:

- `sizeLarge` = 24pt, `sizeMedium` = 20pt, `sizeSmall` = 16pt, `sizeXSmall` = 14pt

| Token | Asset Name | Size |
|-------|-----------|------|
| `arrowLeft` | `arrow_left` | 24px |
| `search` | `Search` | 20px |
| `user` | `User` | 20px |
| `shoppingCart` | `Shopping cart` | 20px |
| `mapPin` | `Map pin` | 20px |
| `home` | `Home` | 20px |
| `close` | `Close icon` | 16px |
| `circleExclamation` | `circle_exclamation_point` | 14px |

Usage: `DSIcons.arrowLeft.resizable().frame(width: DSIcons.sizeLarge, height: DSIcons.sizeLarge).foregroundStyle(DSColors.contentPrimary)`

### Images (DSImages)

| Token | Asset Name | Description |
|-------|-----------|-------------|
| `dsImage` | `DS.Image` | Placeholder image |
| `homeBG` | `HomeBG` | Home background |
| `searchBG` | `SearchBG` | Search background |

Usage: `DSImages.homeBG.resizable().aspectRatio(contentMode: .fill)`

## Coding Conventions

### File Structure
- Every file starts with a header comment: purpose, flow context
- Use `// MARK: -` to organize sections
- Include `#Preview` at the bottom of every view file
- Step enums live in the ViewModel file, not in a separate file

### Naming
- Views: `{ScreenName}View.swift`
- ViewModels: `{FlowName}ViewModel.swift`
- Flow coordinators: `{FlowName}Flow.swift`
- Design components: `DS{ComponentName}.swift`
- Design tokens: `DS{Category}.swift`

### Figma-to-Code Name Mapping

Figma DS components use dot-slash hierarchy. Map them to code as follows:

- `DS.Button / Standard` → `DSButton.swift` in `DesignSystem/Components/` (variant `Standard` becomes a parameter or enum case)
- `DS.Input/DS.TextField` → `DSTextField.swift` in `DesignSystem/Components/` (deepest component name becomes the filename)
- `{FlowName}-{description}` asset layer → `Image("{FlowName}-{description}")` in code
- `{ScreenName}View` frame → `Features/{FlowName}/Views/{ScreenName}View.swift`
- State suffixes (` - Default`, ` - Active`, ` - Disabled`, ` - Error`) indicate component states to implement, not separate files

### Navigation
- Each flow owns its own `NavigationStack(path:)` bound to `viewModel.path`
- Use `.navigationDestination(for: {Step}.self)` for routing
- Always hide system nav bar (`.navigationBarHidden(true)`) — use custom top nav instead
- Pass `onDismiss: () -> Void` closures for flow exit, bubbling up to ContentView

### State Management
- ViewModels are `@Observable` classes
- Views access ViewModel via `@Environment(FlowViewModel.self) private var viewModel`
- Views should be as stateless as possible; state lives in ViewModel
- Use computed properties for derived state

### SwiftUI Patterns
- Use `VStack(spacing: DSSpacing.none)` as the root layout — control spacing explicitly
- Background colors go on the outermost container
- Use `Spacer()` for flexible layout, not arbitrary padding
- **ALWAYS** use `DSColors` for colors — never hardcode hex values
- **ALWAYS** use `DSTypography` for fonts — never use `.font(.title)` or `.font(.system(...))`
- **ALWAYS** use `DSSpacing` for padding/spacing — never hardcode numeric values
- **ALWAYS** use `DSIcons` for icons — never use `Image("...")` with raw asset names or `Image(systemName:)` for custom icons
- **ALWAYS** use `DSImages` for images — never use `Image("...")` with raw asset names

## When Adding a New Flow

Refer to `FLOW_TEMPLATE.md` in the project root for the full checklist.

## References

- Design system reference: `SPEC.md`
- Flow template: `FLOW_TEMPLATE.md`
- Getting started: `README.md`
